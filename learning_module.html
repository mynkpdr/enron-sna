<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>The Invisible Org Chart ‚Äî Enron SNA Learning Module</title>
  <meta name="description" content="An interactive lesson contrasting formal organizational hierarchies with real communication networks, using the Enron Email Corpus as a case study." />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.9.0/d3.min.js"></script>

  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #05070d; --bg2: #0b0f1a; --bg3: #111827; --bg4: #1a2332;
      --border: #1e2a3a; --accent: #00e5ff; --accent2: #ff4d6d;
      --accent3: #a855f7; --amber: #fbbf24; --green: #22c55e;
      --text: #e2e8f0; --muted: #64748b; --font-ui: "Syne", sans-serif;
      --font-mono: "Space Mono", monospace;
    }

    html { scroll-behavior: smooth; }
    body {
      background: var(--bg); color: var(--text); font-family: var(--font-ui);
      font-size: 15px; line-height: 1.7; overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      background: rgba(5,7,13,0.92); backdrop-filter: blur(16px);
      border-bottom: 1px solid var(--border); padding: 0 32px; height: 52px;
      display: flex; align-items: center; justify-content: space-between;
    }
    nav::after {
      content: ""; position: absolute; bottom: 0; left: 0; right: 0; height: 1px;
      background: linear-gradient(90deg, transparent, var(--accent) 40%, var(--accent3) 60%, transparent);
      opacity: 0.5;
    }
    .nav-logo {
      font-family: var(--font-mono); font-size: 13px; color: var(--accent);
      letter-spacing: 0.13em; text-transform: uppercase;
    }
    .nav-logo span { color: var(--accent2); }
    .nav-links { display: flex; gap: 24px; }
    .nav-links a {
      font-size: 12px; color: var(--muted); text-decoration: none;
      text-transform: uppercase; letter-spacing: 0.1em; transition: color 0.2s;
    }
    .nav-links a:hover { color: var(--accent); }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    .hero {
      min-height: 100vh; display: flex; flex-direction: column; align-items: center;
      justify-content: center; text-align: center; padding: 80px 32px 64px;
      position: relative; overflow: hidden;
    }
    .hero::before {
      content: ""; position: absolute; inset: 0; pointer-events: none;
      background: radial-gradient(ellipse 70% 60% at 50% 40%, rgba(0,229,255,0.06) 0%, transparent 70%),
                  radial-gradient(ellipse 50% 50% at 70% 60%, rgba(168,85,247,0.04) 0%, transparent 60%);
    }
    .hero-badge {
      font-family: var(--font-mono); font-size: 11px; color: var(--accent3);
      text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 20px;
      border: 1px solid rgba(168,85,247,0.3); padding: 6px 18px; border-radius: 20px;
      background: rgba(168,85,247,0.06);
    }
    .hero h1 {
      font-size: clamp(2.4rem, 5vw, 4.2rem); font-weight: 800;
      line-height: 1.15; max-width: 800px; margin-bottom: 20px;
    }
    .hero h1 .glow {
      background: linear-gradient(135deg, var(--accent), var(--accent3));
      -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;
    }
    .hero-sub {
      font-size: 17px; color: var(--muted); max-width: 600px; margin-bottom: 48px;
      line-height: 1.6;
    }

    .stat-bar {
      display: flex; gap: 40px; flex-wrap: wrap; justify-content: center;
    }
    .stat-card {
      background: rgba(11,15,26,0.8); border: 1px solid var(--border);
      border-radius: 12px; padding: 20px 28px; min-width: 140px;
      backdrop-filter: blur(8px); text-align: center;
      transition: border-color 0.3s, transform 0.3s;
    }
    .stat-card:hover { border-color: var(--accent); transform: translateY(-3px); }
    .stat-val {
      font-family: var(--font-mono); font-size: 28px; font-weight: 700;
      color: var(--accent); display: block; line-height: 1.2;
    }
    .stat-lbl {
      font-size: 11px; color: var(--muted); text-transform: uppercase;
      letter-spacing: 0.12em; margin-top: 4px;
    }

    .scroll-hint {
      position: absolute; bottom: 32px; left: 50%; transform: translateX(-50%);
      font-family: var(--font-mono); font-size: 10px; color: var(--muted);
      text-transform: uppercase; letter-spacing: 0.15em;
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse { 0%, 100% { opacity: 0.4; } 50% { opacity: 1; } }

    /* ‚îÄ‚îÄ SECTION LAYOUT ‚îÄ‚îÄ */
    .section {
      max-width: 1200px; margin: 0 auto; padding: 100px 32px;
    }
    .section-label {
      font-family: var(--font-mono); font-size: 11px; color: var(--accent3);
      text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: 12px;
    }
    .section h2 {
      font-size: clamp(1.6rem, 3vw, 2.4rem); font-weight: 700;
      margin-bottom: 16px; line-height: 1.25;
    }
    .section h2 .hl { color: var(--accent); }
    .section-desc {
      font-size: 15px; color: var(--muted); max-width: 700px; margin-bottom: 40px;
      line-height: 1.7;
    }

    /* ‚îÄ‚îÄ EXPLAINER CARDS ‚îÄ‚îÄ */
    .explainer-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px; margin-top: 40px;
    }
    .explainer-card {
      background: var(--bg2); border: 1px solid var(--border); border-radius: 12px;
      padding: 28px; transition: border-color 0.3s, transform 0.3s;
    }
    .explainer-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .explainer-card .icon {
      width: 44px; height: 44px; border-radius: 10px; display: flex;
      align-items: center; justify-content: center; font-size: 22px;
      margin-bottom: 16px;
    }
    .explainer-card h3 {
      font-size: 16px; font-weight: 700; margin-bottom: 8px;
    }
    .explainer-card p { font-size: 13px; color: var(--muted); line-height: 1.6; }

    /* ‚îÄ‚îÄ COMPARISON ‚îÄ‚îÄ */
    .comparison-wrap {
      display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 40px;
    }
    @media (max-width: 768px) { .comparison-wrap { grid-template-columns: 1fr; } }
    .comp-panel {
      background: var(--bg2); border: 1px solid var(--border); border-radius: 14px;
      overflow: hidden;
    }
    .comp-header {
      padding: 16px 20px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; gap: 10px;
    }
    .comp-header .dot {
      width: 10px; height: 10px; border-radius: 50%;
    }
    .comp-header h3 {
      font-family: var(--font-mono); font-size: 13px; text-transform: uppercase;
      letter-spacing: 0.1em;
    }
    .comp-body { padding: 10px; min-height: 420px; position: relative; }
    .comp-body svg { width: 100%; height: 400px; }

    /* ‚îÄ‚îÄ POWER BROKERS ‚îÄ‚îÄ */
    .broker-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px; margin-top: 40px;
    }
    .broker-card {
      background: var(--bg2); border: 1px solid var(--border); border-radius: 14px;
      padding: 28px; position: relative; overflow: hidden;
      transition: border-color 0.3s, transform 0.3s;
    }
    .broker-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .broker-card::before {
      content: ""; position: absolute; top: 0; left: 0; right: 0; height: 3px;
    }
    .broker-card.executive::before { background: linear-gradient(90deg, var(--accent), var(--accent3)); }
    .broker-card.hidden-broker::before { background: linear-gradient(90deg, var(--amber), var(--accent2)); }
    .broker-tag {
      font-family: var(--font-mono); font-size: 10px; text-transform: uppercase;
      letter-spacing: 0.15em; padding: 4px 12px; border-radius: 12px;
      display: inline-block; margin-bottom: 12px;
    }
    .broker-tag.exec { background: rgba(0,229,255,0.1); color: var(--accent); }
    .broker-tag.secret { background: rgba(251,191,36,0.12); color: var(--amber); }
    .broker-name {
      font-size: 20px; font-weight: 700; margin-bottom: 4px;
    }
    .broker-title {
      font-size: 12px; color: var(--muted); margin-bottom: 16px;
    }
    .broker-metrics {
      display: grid; grid-template-columns: 1fr 1fr; gap: 10px;
    }
    .broker-metric {
      background: var(--bg3); border-radius: 8px; padding: 10px 12px;
    }
    .broker-metric .val {
      font-family: var(--font-mono); font-size: 16px; font-weight: 700;
      display: block;
    }
    .broker-metric .lbl {
      font-size: 10px; color: var(--muted); text-transform: uppercase;
      letter-spacing: 0.08em;
    }
    .broker-insight {
      margin-top: 16px; padding: 12px 14px; background: rgba(0,229,255,0.04);
      border-left: 3px solid var(--accent); border-radius: 0 8px 8px 0;
      font-size: 12px; color: var(--text); line-height: 1.5;
    }
    .broker-insight.warn {
      background: rgba(251,191,36,0.04); border-left-color: var(--amber);
    }

    /* ‚îÄ‚îÄ MINI NETWORK ‚îÄ‚îÄ */
    #mini-network-wrap {
      background: var(--bg2); border: 1px solid var(--border); border-radius: 14px;
      overflow: hidden; margin-top: 40px;
    }
    #mini-network-header {
      padding: 16px 20px; border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
    }
    #mini-network-header h3 {
      font-family: var(--font-mono); font-size: 13px; color: var(--accent);
      text-transform: uppercase; letter-spacing: 0.1em;
    }
    .mini-controls { display: flex; gap: 8px; }
    .mini-btn {
      font-family: var(--font-mono); font-size: 10px; text-transform: uppercase;
      letter-spacing: 0.07em; padding: 5px 12px; border: 1px solid var(--border);
      background: var(--bg3); color: var(--muted); border-radius: 6px;
      cursor: pointer; transition: all 0.2s;
    }
    .mini-btn:hover, .mini-btn.active { border-color: var(--accent); color: var(--accent); }
    #mini-network-svg { width: 100%; height: 500px; cursor: grab; }
    #mini-network-svg:active { cursor: grabbing; }
    #mini-tooltip {
      position: absolute; background: rgba(10,14,22,0.96); border: 1px solid var(--accent);
      border-radius: 8px; padding: 10px 14px; pointer-events: none;
      max-width: 240px; z-index: 50; display: none; font-size: 11px;
      box-shadow: 0 0 20px rgba(0,229,255,0.15);
    }
    .mini-tt-name { font-family: var(--font-mono); font-size: 12px; color: var(--accent); margin-bottom: 4px; }
    .mini-tt-role { font-size: 10px; color: var(--accent3); margin-bottom: 8px; }
    .mini-tt-row { display: flex; justify-content: space-between; gap: 12px; margin-bottom: 2px; }
    .mini-tt-key { color: var(--muted); }
    .mini-tt-val { color: var(--text); font-family: var(--font-mono); }

    /* ‚îÄ‚îÄ QUIZ ‚îÄ‚îÄ */
    .quiz-wrap { margin-top: 40px; }
    .quiz-q {
      background: var(--bg2); border: 1px solid var(--border); border-radius: 12px;
      padding: 24px 28px; margin-bottom: 16px;
    }
    .quiz-q h4 {
      font-size: 14px; font-weight: 700; margin-bottom: 14px; display: flex;
      align-items: center; gap: 10px;
    }
    .quiz-q h4 .qnum {
      font-family: var(--font-mono); font-size: 11px; background: var(--accent3);
      color: #fff; width: 26px; height: 26px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center; flex-shrink: 0;
    }
    .quiz-options { display: flex; flex-direction: column; gap: 8px; }
    .quiz-opt {
      display: flex; align-items: center; gap: 10px; padding: 10px 14px;
      background: var(--bg3); border: 1px solid var(--border); border-radius: 8px;
      cursor: pointer; transition: all 0.2s; font-size: 13px;
    }
    .quiz-opt:hover { border-color: var(--accent); background: rgba(0,229,255,0.04); }
    .quiz-opt.selected { border-color: var(--accent3); background: rgba(168,85,247,0.08); }
    .quiz-opt.correct { border-color: var(--green); background: rgba(34,197,94,0.08); }
    .quiz-opt.wrong { border-color: var(--accent2); background: rgba(255,77,109,0.08); opacity: 0.6; }
    .quiz-opt .radio {
      width: 16px; height: 16px; border: 2px solid var(--border); border-radius: 50%;
      flex-shrink: 0; position: relative;
    }
    .quiz-opt.selected .radio, .quiz-opt.correct .radio {
      border-color: var(--accent3);
    }
    .quiz-opt.selected .radio::after, .quiz-opt.correct .radio::after {
      content: ""; position: absolute; inset: 3px; border-radius: 50%;
      background: var(--accent3);
    }
    .quiz-opt.correct .radio { border-color: var(--green); }
    .quiz-opt.correct .radio::after { background: var(--green); }
    .quiz-feedback {
      margin-top: 10px; padding: 10px 14px; border-radius: 8px; font-size: 12px;
      display: none; line-height: 1.5;
    }
    .quiz-feedback.show { display: block; }
    .quiz-feedback.right { background: rgba(34,197,94,0.08); color: var(--green); }
    .quiz-feedback.incorrect { background: rgba(255,77,109,0.08); color: var(--accent2); }

    .quiz-submit {
      margin-top: 24px; padding: 12px 32px; font-family: var(--font-mono);
      font-size: 13px; text-transform: uppercase; letter-spacing: 0.1em;
      background: linear-gradient(135deg, var(--accent), var(--accent3));
      border: none; border-radius: 8px; color: #000; font-weight: 700;
      cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
    }
    .quiz-submit:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(0,229,255,0.3); }

    .quiz-score {
      margin-top: 20px; padding: 20px 24px; background: var(--bg2);
      border: 1px solid var(--accent); border-radius: 12px; display: none; text-align: center;
    }
    .quiz-score .big {
      font-family: var(--font-mono); font-size: 42px; font-weight: 700;
      color: var(--accent);
    }

    /* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
    footer {
      text-align: center; padding: 48px 32px; border-top: 1px solid var(--border);
      color: var(--muted); font-size: 12px;
    }
    footer a { color: var(--accent); text-decoration: none; }
    footer a:hover { text-decoration: underline; }

    /* ‚îÄ‚îÄ SEPARATOR ‚îÄ‚îÄ */
    .sep {
      max-width: 1200px; margin: 0 auto; padding: 0 32px;
    }
    .sep hr {
      border: none; height: 1px;
      background: linear-gradient(90deg, transparent, var(--border) 20%, var(--border) 80%, transparent);
    }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<nav>
  <div class="nav-logo">Enron<span>::</span>SNA <span>// Learning Module</span></div>
  <div class="nav-links">
    <a href="#exhaust">Digital Exhaust</a>
    <a href="#compare">Compare</a>
    <a href="#brokers">Power Brokers</a>
    <a href="#network">Network</a>
    <a href="#quiz">Quiz</a>
    <a href="index.html">Dashboard ‚Üó</a>
  </div>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HERO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="hero">
  <div class="hero-badge">MBA ¬∑ Organizational Development ¬∑ IIMB</div>
  <h1>The Org Chart is a <span class="glow">Fiction</span></h1>
  <p class="hero-sub">
    Every company has two org charts. The <em>official</em> one hanging on the wall ‚Äî and the <em>invisible</em> one
    hiding in 359,219 emails. We analyzed the entire Enron email corpus to find who <strong>really</strong> held power.
  </p>
  <div class="stat-bar">
    <div class="stat-card">
      <span class="stat-val" data-target="359219">0</span>
      <div class="stat-lbl">Emails Parsed</div>
    </div>
    <div class="stat-card">
      <span class="stat-val" data-target="19094">0</span>
      <div class="stat-lbl">People</div>
    </div>
    <div class="stat-card">
      <span class="stat-val" data-target="173899">0</span>
      <div class="stat-lbl">Connections</div>
    </div>
    <div class="stat-card">
      <span class="stat-val" data-target="31">0</span>
      <div class="stat-lbl">Communities</div>
    </div>
  </div>
  <div class="scroll-hint">‚ñº Scroll to explore</div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DIGITAL EXHAUST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sep"><hr/></div>
<section class="section" id="exhaust">
  <div class="section-label">Section 01</div>
  <h2>Mining the <span class="hl">Digital Exhaust</span></h2>
  <p class="section-desc">
    Every email, Slack message, and code commit leaves breadcrumbs. We call this <strong>digital exhaust</strong> ‚Äî
    the metadata trail that reveals the <em>actual</em> organization, not the one drawn on paper.
    Traditional org charts show <em>who should report to whom</em>. SNA reveals <em>who actually talks to whom</em>.
  </p>
  <div class="explainer-grid">
    <div class="explainer-card">
      <div class="icon" style="background:rgba(0,229,255,0.1);">üìß</div>
      <h3>From/To/CC Headers</h3>
      <p>We don't read the emails. We only need the <em>metadata</em> ‚Äî who contacted whom, when, and how many recipients.
         A 1-to-1 email means a strong tie. A blast to 100 people? Almost meaningless per recipient.</p>
    </div>
    <div class="explainer-card">
      <div class="icon" style="background:rgba(168,85,247,0.1);">üï∏Ô∏è</div>
      <h3>Build the Network</h3>
      <p>Each person becomes a <strong>node</strong>. Each email exchange becomes an <strong>edge</strong> weighted by
         frequency. The result: 19,094 nodes connected by 173,899 edges ‚Äî a living map of Enron's communication.</p>
    </div>
    <div class="explainer-card">
      <div class="icon" style="background:rgba(255,77,109,0.1);">üîç</div>
      <h3>Find the Hidden Structure</h3>
      <p>Algorithms detect <strong>communities</strong> (groups that talk internally more than externally) and
         <strong>centrality metrics</strong> that reveal who are the true connectors, bottlenecks, and influencers.</p>
    </div>
    <div class="explainer-card">
      <div class="icon" style="background:rgba(251,191,36,0.1);">‚ö°</div>
      <h3>The Invisible Hierarchy</h3>
      <p>The CEO sent only <strong>88 emails</strong> but was the single most important bridge in the network.
         An admin assistant with no reports was the 4th most connected broker. <em>Titles lie. Data doesn't.</em></p>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SIDE-BY-SIDE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sep"><hr/></div>
<section class="section" id="compare">
  <div class="section-label">Section 02</div>
  <h2>Formal Hierarchy vs. <span class="hl">Real Network</span></h2>
  <p class="section-desc">
    On the left: the <em>official</em> Enron org chart based on public records.
    On the right: the <em>actual</em> communication network derived from email metadata.
    Notice who disappears ‚Äî and who emerges.
  </p>
  <div class="comparison-wrap">
    <!-- Formal Hierarchy -->
    <div class="comp-panel">
      <div class="comp-header">
        <div class="dot" style="background:var(--muted);"></div>
        <h3 style="color:var(--muted);">Formal Org Chart</h3>
      </div>
      <div class="comp-body" id="tree-panel">
        <svg id="tree-svg"></svg>
      </div>
    </div>
    <!-- Real Network -->
    <div class="comp-panel">
      <div class="comp-header">
        <div class="dot" style="background:var(--accent);"></div>
        <h3 style="color:var(--accent);">Actual Email Network</h3>
      </div>
      <div class="comp-body" id="network-panel">
        <svg id="net-svg"></svg>
      </div>
    </div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê POWER BROKERS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sep"><hr/></div>
<section class="section" id="brokers">
  <div class="section-label">Section 03</div>
  <h2>Unmasking the <span class="hl">Power Brokers</span></h2>
  <p class="section-desc">
    <strong>Betweenness Centrality</strong> measures how often a person sits on the shortest path between others.
    High betweenness = information bottleneck. <strong>PageRank</strong> measures recursive importance ‚Äî you're important
    if important people talk to you. Together, they reveal two kinds of hidden power.
  </p>

  <div class="broker-grid" id="broker-grid">
    <!-- Populated by JS -->
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MINI NETWORK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sep"><hr/></div>
<section class="section" id="network">
  <div class="section-label">Section 04</div>
  <h2>Explore the <span class="hl">Live Network</span></h2>
  <p class="section-desc">
    Interact with the top 100 communicators in the Enron corpus. Nodes are sized by PageRank and colored by
    inferred role. Hover for details. Drag to rearrange.
  </p>
  <div id="mini-network-wrap" style="position:relative;">
    <div id="mini-network-header">
      <h3>Sphere Network ‚Äî Top 100 Nodes</h3>
      <div class="mini-controls">
        <button class="mini-btn" data-color="role">By Role</button>
        <button class="mini-btn active" data-color="community">By Community</button>
        <button class="mini-btn" data-color="betweenness">By Betweenness</button>
      </div>
    </div>
    <svg id="mini-network-svg"></svg>
    <div id="mini-tooltip"></div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="sep"><hr/></div>
<section class="section" id="quiz">
  <div class="section-label">Section 05</div>
  <h2>Test Your <span class="hl">Understanding</span></h2>
  <p class="section-desc">
    Five questions to check whether you've grasped the key concepts of organizational network analysis.
  </p>
  <div class="quiz-wrap" id="quiz-wrap">
    <!-- Populated by JS -->
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FOOTER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<footer>
  <p>Enron SNA Learning Module ¬∑ Built for the OD Course at IIMB ¬∑ Data: <a href="https://www.kaggle.com/datasets/wcukierski/enron-email-dataset" target="_blank">Enron Email Dataset</a></p>
  <p style="margin-top:8px;"><a href="index.html">‚Üê Back to Dashboard</a> ¬∑ <a href="od_syllabus.html">OD Syllabus Mapping ‚Üí</a></p>
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DATA LOADING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let graphData, statsData, topNodes, communities;

async function loadData() {
  [graphData, statsData, topNodes, communities] = await Promise.all([
    fetch("sna_output/graph_data.json").then(r => r.json()),
    fetch("sna_output/stats.json").then(r => r.json()),
    fetch("sna_output/top_nodes.json").then(r => r.json()),
    fetch("sna_output/communities.json").then(r => r.json()),
  ]);
  initAll();
}

function initAll() {
  animateCounters();
  renderTree();
  renderComparisonNetwork();
  renderBrokerCards();
  renderMiniNetwork();
  renderQuiz();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  ANIMATED COUNTERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function animateCounters() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(e => {
      if (!e.isIntersecting) return;
      const el = e.target;
      const target = +el.dataset.target;
      const duration = 1800;
      const start = performance.now();
      function tick(now) {
        const p = Math.min((now - start) / duration, 1);
        const ease = 1 - Math.pow(1 - p, 3);
        el.textContent = Math.round(target * ease).toLocaleString();
        if (p < 1) requestAnimationFrame(tick);
      }
      requestAnimationFrame(tick);
      observer.unobserve(el);
    });
  }, { threshold: 0.5 });
  document.querySelectorAll(".stat-val[data-target]").forEach(el => observer.observe(el));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FORMAL HIERARCHY TREE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderTree() {
  const treeData = {
    name: "Enron Corp", children: [
      { name: "K. Lay", role: "Chairman", children: [
        { name: "J. Skilling", role: "CEO", children: [
          { name: "L. Kitchen", role: "Pres, EOL", children: [
            { name: "J. Lavorato", role: "COO" },
            { name: "D. Delainey", role: "CEO, EES" }
          ]},
          { name: "R. Buy", role: "CRO" },
          { name: "S. Kean", role: "VP Gov" },
          { name: "M. Frevert", role: "Vice Chair" }
        ]},
        { name: "J. Derrick", role: "Gen Counsel", children: [
          { name: "R. Sanders", role: "VP Legal" },
          { name: "M. Haedicke", role: "MD Legal" }
        ]},
        { name: "R. Causey", role: "CAO", children: [
          { name: "S. Beck", role: "VP Ops" },
          { name: "W. Colwell", role: "VP Acctg" }
        ]}
      ]}
    ]
  };

  const svg = d3.select("#tree-svg");
  const panelW = document.getElementById("tree-panel").clientWidth;
  const width = panelW - 10;
  const height = 400;
  svg.attr("viewBox", `0 0 ${width} ${height}`);

  // Glow filter for root node
  const defs = svg.append("defs");
  const glow = defs.append("filter").attr("id", "tree-glow").attr("x", "-50%").attr("y", "-50%").attr("width", "200%").attr("height", "200%");
  glow.append("feGaussianBlur").attr("stdDeviation", "3").attr("result", "blur");
  glow.append("feMerge").selectAll("feMergeNode").data(["blur", "SourceGraphic"]).join("feMergeNode").attr("in", d => d);

  const root = d3.hierarchy(treeData);
  const treeLayout = d3.tree()
    .size([width - 40, height - 100])
    .separation((a, b) => a.parent === b.parent ? 1.2 : 1.6);
  treeLayout(root);

  const g = svg.append("g").attr("transform", `translate(20, 35)`);

  // Curved links (elbow style)
  g.selectAll(".tree-link")
    .data(root.links())
    .join("path")
    .attr("class", "tree-link")
    .attr("d", d => {
      const sx = d.source.x, sy = d.source.y;
      const tx = d.target.x, ty = d.target.y;
      const my = (sy + ty) / 2;
      return `M${sx},${sy} C${sx},${my} ${tx},${my} ${tx},${ty}`;
    })
    .attr("fill", "none")
    .attr("stroke", "#2e4a66").attr("stroke-width", 1.5).attr("stroke-opacity", 0.5);

  // Depth-based colors
  const depthColors = ["#64748b", "#3b82f6", "#6366f1", "#8b5cf6", "#a78bfa"];

  // Nodes
  const node = g.selectAll(".tree-node")
    .data(root.descendants())
    .join("g")
    .attr("class", "tree-node")
    .attr("transform", d => `translate(${d.x}, ${d.y})`);

  node.append("circle")
    .attr("r", d => d.depth === 0 ? 9 : d.children ? 6 : 5)
    .attr("fill", d => depthColors[Math.min(d.depth, depthColors.length - 1)])
    .attr("stroke", d => d.depth === 0 ? "#94a3b8" : "#4e6a8a")
    .attr("stroke-width", d => d.depth === 0 ? 2 : 1)
    .attr("filter", d => d.depth === 0 ? "url(#tree-glow)" : null);

  // Labels ‚Äî alternate above/below for leaf nodes to avoid overlap
  node.each(function(d, i) {
    const el = d3.select(this);
    const isLeaf = !d.children;
    // Alternate leaf labels above/below
    const leafIdx = isLeaf ? d.parent.children.indexOf(d) : 0;
    const above = d.depth === 0 || (d.children) || (leafIdx % 2 === 0);
    const nameY = above ? -12 : 14;
    const roleY = above ? -12 + 10 : 14 + 10;

    el.append("text")
      .attr("x", 0).attr("y", nameY)
      .attr("text-anchor", "middle")
      .attr("fill", "#e2e8f0").attr("font-size", d.depth <= 1 ? "8px" : "7px")
      .attr("font-weight", d.depth <= 1 ? "700" : "400")
      .attr("font-family", "Space Mono, monospace")
      .text(d.data.name);

    el.append("text")
      .attr("x", 0).attr("y", roleY)
      .attr("text-anchor", "middle")
      .attr("fill", "#64748b").attr("font-size", "6px")
      .attr("font-family", "Space Mono, monospace")
      .text(d.data.role || "");
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  COMPARISON NETWORK ‚Äî SPHERE-STYLE (matching index.html)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderComparisonNetwork() {
  // Use top 40 nodes by PageRank for a denser, more dramatic comparison
  const top40 = graphData.nodes
    .slice().sort((a,b) => b.pagerank - a.pagerank)
    .slice(0, 40);
  const nodeSet = new Set(top40.map(n => n.id));
  const nodes = top40.map(n => ({...n}));
  const edges = graphData.edges
    .filter(e => nodeSet.has(e.source) && nodeSet.has(e.target))
    .map(e => ({source: e.source, target: e.target, weight: e.weight}));

  const svg = d3.select("#net-svg");
  const width = document.getElementById("network-panel").clientWidth - 10;
  const height = 400;
  svg.attr("viewBox", `0 0 ${width} ${height}`);

  // ‚îÄ‚îÄ Glow filter (same as index.html) ‚îÄ‚îÄ
  const defs = svg.append("defs");
  const glowF = defs.append("filter").attr("id", "net-glow").attr("x", "-50%").attr("y", "-50%").attr("width", "200%").attr("height", "200%");
  glowF.append("feGaussianBlur").attr("stdDeviation", "4").attr("result", "blur");
  glowF.append("feMerge").selectAll("feMergeNode").data(["blur", "SourceGraphic"]).join("feMergeNode").attr("in", d => d);

  // ‚îÄ‚îÄ Community-aware sphere positions (Fibonacci banding, same as index.html) ‚îÄ‚îÄ
  const communities = [...new Set(nodes.map(n => n.community ?? -1))].sort((a,b) => a - b);
  const commIdx = new Map(communities.map((c,i) => [c, i]));
  const nComm = communities.length || 1;
  const commCounts = new Map();
  nodes.forEach(n => { const c = n.community ?? -1; commCounts.set(c, (commCounts.get(c) || 0) + 1); });
  const commOff = new Map(communities.map(c => [c, 0]));
  const GOLDEN = (1 + Math.sqrt(5)) / 2;
  const cx = width / 2, cy = height / 2;
  const sphR = Math.min(width, height) * 0.36;

  nodes.forEach(n => {
    const c = n.community ?? -1, ci = commIdx.get(c) || 0;
    const li = commOff.get(c) || 0;
    commOff.set(c, li + 1);
    const localN = commCounts.get(c) || 1;
    const latMin = (ci / nComm) * Math.PI * 0.92 + 0.08 * Math.PI;
    const latMax = ((ci + 1) / nComm) * Math.PI * 0.92 + 0.08 * Math.PI;
    const t = localN > 1 ? (li + 0.5) / localN : 0.5;
    const phi = latMin + t * (latMax - latMin);
    const theta = (2 * Math.PI * li) / GOLDEN + ci * 2.1;
    // Project 3D sphere to 2D (orthographic)
    n.x = cx + sphR * Math.sin(phi) * Math.cos(theta);
    n.y = cy + sphR * Math.cos(phi);
    n._z = Math.sin(phi) * Math.sin(theta); // for depth sorting
  });

  // Community color palette (same as index.html)
  const commPal = d3.scaleOrdinal()
    .domain(communities)
    .range(["#00e5ff","#a855f7","#ff4d6d","#22c55e","#fbbf24","#f97316","#06b6d4","#ec4899","#84cc16","#6366f1","#14b8a6","#ef4444"]);

  const prScale = d3.scaleSqrt().domain(d3.extent(nodes, d => d.pagerank)).range([3, 18]);
  const q85 = d3.quantile(nodes.map(n => n.pagerank).sort(d3.ascending), 0.85) || 0;

  // ‚îÄ‚îÄ Sphere guide circle ‚îÄ‚îÄ
  svg.append("circle")
    .attr("cx", cx).attr("cy", cy).attr("r", sphR)
    .attr("fill", "none").attr("stroke", "rgba(0,229,255,0.06)")
    .attr("stroke-width", 1).attr("stroke-dasharray", "4,4");

  // ‚îÄ‚îÄ Build edge refs ‚îÄ‚îÄ
  const nodeMap = new Map(nodes.map(n => [n.id, n]));
  const edgeObjs = edges.map(e => ({...e, _src: nodeMap.get(e.source), _tgt: nodeMap.get(e.target)}))
    .filter(e => e._src && e._tgt);

  // Edge weight scale
  const wv = edgeObjs.map(e => e.weight || 1);
  const wMin = Math.max(d3.min(wv) || 0.01, 0.01), wMax = d3.max(wv) || 1;
  const stSc = d3.scaleLog().domain([wMin, wMax]).range([0.3, 2.5]).clamp(true);

  // ‚îÄ‚îÄ Draw edges ‚îÄ‚îÄ
  const linkG = svg.append("g");
  linkG.selectAll("line").data(edgeObjs).join("line")
    .attr("x1", d => d._src.x).attr("y1", d => d._src.y)
    .attr("x2", d => d._tgt.x).attr("y2", d => d._tgt.y)
    .attr("stroke", "rgba(0,229,255,0.12)")
    .attr("stroke-width", d => stSc(d.weight || 1))
    .attr("stroke-opacity", d => 0.15 + 0.2 * Math.min(1, (d.weight || 1) / (wMax * 0.5)));

  // ‚îÄ‚îÄ Draw nodes (sorted by depth for pseudo-3D) ‚îÄ‚îÄ
  nodes.sort((a,b) => a._z - b._z);

  const nodeG = svg.append("g");
  const ng = nodeG.selectAll("g").data(nodes).join("g")
    .attr("transform", d => `translate(${d.x},${d.y})`)
    .style("cursor", "pointer");

  ng.append("circle")
    .attr("r", d => prScale(d.pagerank))
    .attr("fill", d => commPal(d.community))
    .attr("stroke", "rgba(255,255,255,0.12)")
    .attr("stroke-width", 0.8)
    .attr("opacity", d => 0.7 + 0.3 * ((d._z + 1) / 2)) // depth fading
    .attr("filter", d => d.pagerank > q85 ? "url(#net-glow)" : null);

  // Labels only for top nodes
  ng.append("text")
    .attr("dy", d => prScale(d.pagerank) + 10)
    .attr("text-anchor", "middle")
    .attr("fill", d => d.pagerank > q85 ? "rgba(226,232,240,0.75)" : "rgba(226,232,240,0)")
    .attr("font-size", "7px")
    .attr("font-family", "Space Mono, monospace")
    .text(d => (d.label || d.id).split("@")[0]);

  // ‚îÄ‚îÄ Tooltip on hover ‚îÄ‚îÄ
  const tt = document.createElement("div");
  tt.style.cssText = "position:absolute;background:rgba(10,14,22,0.96);border:1px solid #00e5ff;border-radius:8px;padding:8px 12px;pointer-events:none;display:none;font-size:10px;z-index:50;box-shadow:0 0 16px rgba(0,229,255,0.15);font-family:Space Mono,monospace;color:#e2e8f0;";
  document.getElementById("network-panel").appendChild(tt);

  ng.on("mouseenter", (e, d) => {
    tt.style.display = "block";
    tt.innerHTML = `<div style="color:#00e5ff;font-weight:700;margin-bottom:3px;">${d.label}</div>`
      + `<div style="color:#a855f7;font-size:9px;margin-bottom:5px;">${d.inferred_role} ¬∑ Community ${d.community}</div>`
      + `<div>PageRank: ${d.pagerank.toFixed(5)}</div>`
      + `<div>Betweenness: ${d.betweenness.toFixed(5)}</div>`
      + `<div>Sent: ${d.sent} ¬∑ Received: ${d.received}</div>`;
  }).on("mousemove", (e) => {
    const rect = document.getElementById("network-panel").getBoundingClientRect();
    tt.style.left = (e.clientX - rect.left + 12) + "px";
    tt.style.top = (e.clientY - rect.top - 10) + "px";
  }).on("mouseleave", () => { tt.style.display = "none"; });

  // ‚îÄ‚îÄ Slow auto-rotation ‚îÄ‚îÄ
  // Pre-compute per-node community-local index to avoid O(n¬≤) per frame
  const commLocalIdx = new Map();
  const commCounterForIdx = new Map();
  nodes.forEach(n => {
    const c = n.community ?? -1;
    const idx = commCounterForIdx.get(c) || 0;
    commLocalIdx.set(n.id, idx);
    commCounterForIdx.set(c, idx + 1);
  });

  let angle = 0;
  function spin() {
    angle += 0.003;
    nodes.forEach(n => {
      const c = n.community ?? -1, ci = commIdx.get(c) || 0;
      const localN = commCounts.get(c) || 1;
      const li = commLocalIdx.get(n.id) || 0;
      const latMin = (ci / nComm) * Math.PI * 0.92 + 0.08 * Math.PI;
      const latMax = ((ci + 1) / nComm) * Math.PI * 0.92 + 0.08 * Math.PI;
      const tVal = localN > 1 ? (li + 0.5) / localN : 0.5;
      const phi = latMin + tVal * (latMax - latMin);
      const theta = (2 * Math.PI * li) / GOLDEN + ci * 2.1 + angle;
      n.x = cx + sphR * Math.sin(phi) * Math.cos(theta);
      n.y = cy + sphR * Math.cos(phi);
      n._z = Math.sin(phi) * Math.sin(theta);
    });
    ng.attr("transform", d => `translate(${d.x},${d.y})`)
      .select("circle").attr("opacity", d => 0.7 + 0.3 * ((d._z + 1) / 2));
    linkG.selectAll("line")
      .attr("x1", d => d._src.x).attr("y1", d => d._src.y)
      .attr("x2", d => d._tgt.x).attr("y2", d => d._tgt.y);
    requestAnimationFrame(spin);
  }
  // Start spinning when section is visible
  const observer = new IntersectionObserver(entries => {
    if (entries[0].isIntersecting) { spin(); observer.disconnect(); }
  }, { threshold: 0.3 });
  observer.observe(document.getElementById("network-panel"));
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  POWER BROKER CARDS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderBrokerCards() {
  const brokerDefs = [
    {
      id: "jeff.skilling@enron.com", type: "executive", tag: "exec", tagText: "Known Executive",
      name: "Jeff Skilling", title: "CEO of Enron",
      insight: "Sent only 88 emails but received 2,972. Despite minimal outbound, his betweenness of 0.0407 means he sat on more shortest-path routes than almost anyone ‚Äî the ultimate silent power center."
    },
    {
      id: "kenneth.lay@enron.com", type: "executive", tag: "exec", tagText: "Known Executive",
      name: "Kenneth Lay", title: "Chairman & Founder",
      insight: "Sent just 31 emails but received 3,632. His PageRank of 0.005 shows he was still the gravitational center ‚Äî important people routed information through him even without direct engagement."
    },
    {
      id: "jacqueline.coleman@enron.com", type: "hidden-broker", tag: "secret", tagText: "Hidden Broker",
      name: "Jacqueline Coleman", title: "Unknown Title ‚Äî Low Volume, Extreme Influence",
      insight: "32 emails sent, 109 received. Yet her betweenness of 0.062 was HIGHER than Jeff Skilling. She was the invisible bridge between entire communities ‚Äî a classic information gatekeeper with no formal power."
    },
    {
      id: "sharon.brown@enron.com", type: "hidden-broker", tag: "secret", tagText: "Hidden Broker",
      name: "Sharon Brown", title: "Unknown Title ‚Äî Low Volume, Strategic Position",
      insight: "58 sent, 284 received. Betweenness of 0.023 puts her in the top 1% of the entire network. She connected communities that otherwise had no link ‚Äî remove her, and entire departments lose contact."
    },
    {
      id: "body.shop@enron.com", type: "hidden-broker", tag: "secret", tagText: "Hidden Broker",
      name: "body.shop (Distribution List)", title: "System Account ‚Äî Highest Betweenness in the Dataset",
      insight: "A non-human account with betweenness of 0.065 ‚Äî the highest in the entire network. It shows that organizational control systems (automated lists, shared accounts) can be more structurally important than any individual."
    },
    {
      id: "rick.buy@enron.com", type: "executive", tag: "exec", tagText: "Known Executive",
      name: "Rick Buy", title: "Chief Risk Officer",
      insight: "Betweenness of 0.033 ‚Äî second only to Skilling among named individuals. As CRO, he sat between every department and the CEO, making him the gatekeeper of risk information. His network position matched his formal power."
    }
  ];

  const grid = document.getElementById("broker-grid");
  brokerDefs.forEach(def => {
    const node = graphData.nodes.find(n => n.id === def.id);
    if (!node) return;
    const card = document.createElement("div");
    card.className = `broker-card ${def.type}`;
    card.innerHTML = `
      <span class="broker-tag ${def.tag}">${def.tagText}</span>
      <div class="broker-name">${def.name}</div>
      <div class="broker-title">${def.title}</div>
      <div class="broker-metrics">
        <div class="broker-metric">
          <span class="val" style="color:var(--accent);">${node.betweenness.toFixed(4)}</span>
          <span class="lbl">Betweenness</span>
        </div>
        <div class="broker-metric">
          <span class="val" style="color:var(--accent3);">${node.pagerank.toFixed(5)}</span>
          <span class="lbl">PageRank</span>
        </div>
        <div class="broker-metric">
          <span class="val">${node.sent.toLocaleString()}</span>
          <span class="lbl">Sent</span>
        </div>
        <div class="broker-metric">
          <span class="val">${node.received.toLocaleString()}</span>
          <span class="lbl">Received</span>
        </div>
      </div>
      <div class="broker-insight ${def.type === 'hidden-broker' ? 'warn' : ''}">${def.insight}</div>
    `;
    grid.appendChild(card);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  MINI NETWORK ‚Äî SPHERE-STYLE (matching index.html)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderMiniNetwork() {
  const top100 = graphData.nodes
    .slice()
    .sort((a,b) => b.pagerank - a.pagerank)
    .slice(0, 100);
  const nodeSet = new Set(top100.map(n => n.id));
  const nodes = top100.map(n => ({...n}));
  const edges = graphData.edges
    .filter(e => nodeSet.has(e.source) && nodeSet.has(e.target))
    .map(e => ({source: e.source, target: e.target, weight: e.weight}));

  const container = document.getElementById("mini-network-wrap");
  const svg = d3.select("#mini-network-svg");
  const width = container.clientWidth;
  const height = 500;
  svg.attr("viewBox", `0 0 ${width} ${height}`);

  // ‚îÄ‚îÄ Glow filter ‚îÄ‚îÄ
  const defs = svg.append("defs");
  const glowF = defs.append("filter").attr("id", "mini-glow").attr("x", "-50%").attr("y", "-50%").attr("width", "200%").attr("height", "200%");
  glowF.append("feGaussianBlur").attr("stdDeviation", "4").attr("result", "blur");
  glowF.append("feMerge").selectAll("feMergeNode").data(["blur", "SourceGraphic"]).join("feMergeNode").attr("in", d => d);

  const prScale = d3.scaleSqrt().domain(d3.extent(nodes, d => d.pagerank)).range([3, 18]);
  const q85 = d3.quantile(nodes.map(n => n.pagerank).sort(d3.ascending), 0.85) || 0;

  // ‚îÄ‚îÄ Community sphere positions ‚îÄ‚îÄ
  const comms = [...new Set(nodes.map(n => n.community ?? -1))].sort((a,b) => a - b);
  const commIdx = new Map(comms.map((c,i) => [c, i]));
  const nComm = comms.length || 1;
  const commCounts = new Map();
  nodes.forEach(n => { const c = n.community ?? -1; commCounts.set(c, (commCounts.get(c) || 0) + 1); });
  const GOLDEN = (1 + Math.sqrt(5)) / 2;
  const cx = width / 2, cy = height / 2;
  const sphR = Math.min(width, height) * 0.4;

  // Pre-compute community-local index
  const commLocalIdx = new Map();
  const commCounter = new Map();
  nodes.forEach(n => {
    const c = n.community ?? -1;
    const idx = commCounter.get(c) || 0;
    commLocalIdx.set(n.id, idx);
    commCounter.set(c, idx + 1);
  });

  // Initial sphere positions
  let _angle = 0;
  function computePositions() {
    nodes.forEach(n => {
      const c = n.community ?? -1, ci = commIdx.get(c) || 0;
      const localN = commCounts.get(c) || 1;
      const li = commLocalIdx.get(n.id) || 0;
      const latMin = (ci / nComm) * Math.PI * 0.92 + 0.08 * Math.PI;
      const latMax = ((ci + 1) / nComm) * Math.PI * 0.92 + 0.08 * Math.PI;
      const t = localN > 1 ? (li + 0.5) / localN : 0.5;
      const phi = latMin + t * (latMax - latMin);
      const theta = (2 * Math.PI * li) / GOLDEN + ci * 2.1 + _angle;
      n.x = cx + sphR * Math.sin(phi) * Math.cos(theta);
      n.y = cy + sphR * Math.cos(phi);
      n._z = Math.sin(phi) * Math.sin(theta);
    });
  }
  computePositions();

  // ‚îÄ‚îÄ Color modes ‚îÄ‚îÄ
  const roleColor = {
    "Executive / Broker": "#00e5ff", "Information Broker": "#a855f7",
    "Broadcaster": "#fbbf24", "Information Sink": "#ff4d6d",
    "Connector": "#22c55e", "Regular Employee": "#64748b"
  };
  const commPal = d3.scaleOrdinal().domain(comms)
    .range(["#00e5ff","#a855f7","#ff4d6d","#22c55e","#fbbf24","#f97316","#06b6d4","#ec4899","#84cc16","#6366f1","#14b8a6","#ef4444"]);
  const betScale = d3.scaleSequential(d3.interpolatePlasma).domain([0, d3.max(nodes, d => d.betweenness)]);

  let colorMode = "community";
  function getColor(d) {
    if (colorMode === "role") return roleColor[d.inferred_role] || "#64748b";
    if (colorMode === "community") return commPal(d.community);
    return betScale(d.betweenness);
  }

  // ‚îÄ‚îÄ Sphere guide circle ‚îÄ‚îÄ
  svg.append("circle")
    .attr("cx", cx).attr("cy", cy).attr("r", sphR)
    .attr("fill", "none").attr("stroke", "rgba(0,229,255,0.05)")
    .attr("stroke-width", 1).attr("stroke-dasharray", "4,4");

  // ‚îÄ‚îÄ Build edge refs ‚îÄ‚îÄ
  const nodeMap = new Map(nodes.map(n => [n.id, n]));
  const edgeObjs = edges.map(e => ({...e, _src: nodeMap.get(e.source), _tgt: nodeMap.get(e.target)}))
    .filter(e => e._src && e._tgt);
  const wv = edgeObjs.map(e => e.weight || 1);
  const wMin = Math.max(d3.min(wv) || 0.01, 0.01), wMax = d3.max(wv) || 1;
  const stSc = d3.scaleLog().domain([wMin, wMax]).range([0.2, 2]).clamp(true);

  // ‚îÄ‚îÄ Draw edges ‚îÄ‚îÄ
  const linkG = svg.append("g");
  const linkSel = linkG.selectAll("line").data(edgeObjs).join("line")
    .attr("x1", d => d._src.x).attr("y1", d => d._src.y)
    .attr("x2", d => d._tgt.x).attr("y2", d => d._tgt.y)
    .attr("stroke", "rgba(0,229,255,0.1)")
    .attr("stroke-width", d => stSc(d.weight || 1))
    .attr("stroke-opacity", d => 0.1 + 0.15 * Math.min(1, (d.weight || 1) / (wMax * 0.5)));

  // ‚îÄ‚îÄ Draw nodes (depth-sorted) ‚îÄ‚îÄ
  nodes.sort((a,b) => a._z - b._z);
  const nodeG = svg.append("g");
  const ng = nodeG.selectAll("g").data(nodes).join("g")
    .attr("transform", d => `translate(${d.x},${d.y})`)
    .style("cursor", "pointer");

  ng.append("circle")
    .attr("r", d => prScale(d.pagerank))
    .attr("fill", d => getColor(d))
    .attr("stroke", "rgba(255,255,255,0.12)")
    .attr("stroke-width", 0.8)
    .attr("opacity", d => 0.65 + 0.35 * ((d._z + 1) / 2))
    .attr("filter", d => d.pagerank > q85 ? "url(#mini-glow)" : null);

  // Labels for top nodes
  ng.append("text")
    .attr("dy", d => prScale(d.pagerank) + 10)
    .attr("text-anchor", "middle")
    .attr("fill", d => d.pagerank > q85 ? "rgba(226,232,240,0.7)" : "rgba(226,232,240,0)")
    .attr("font-size", "7px")
    .attr("font-family", "Space Mono, monospace")
    .text(d => (d.label || d.id).split("@")[0]);

  // ‚îÄ‚îÄ Tooltip ‚îÄ‚îÄ
  const tooltip = document.getElementById("mini-tooltip");
  ng.on("mouseenter", (e, d) => {
    tooltip.style.display = "block";
    tooltip.innerHTML = `
      <div class="mini-tt-name">${d.label}</div>
      <div class="mini-tt-role">${d.inferred_role} ¬∑ Community ${d.community}</div>
      <div class="mini-tt-row"><span class="mini-tt-key">PageRank</span><span class="mini-tt-val">${d.pagerank.toFixed(5)}</span></div>
      <div class="mini-tt-row"><span class="mini-tt-key">Betweenness</span><span class="mini-tt-val">${d.betweenness.toFixed(5)}</span></div>
      <div class="mini-tt-row"><span class="mini-tt-key">Sent</span><span class="mini-tt-val">${d.sent.toLocaleString()}</span></div>
      <div class="mini-tt-row"><span class="mini-tt-key">Received</span><span class="mini-tt-val">${d.received.toLocaleString()}</span></div>
      <div class="mini-tt-row"><span class="mini-tt-key">Contacts</span><span class="mini-tt-val">${d.unique_contacts}</span></div>
    `;
  }).on("mousemove", (e) => {
    const rect = container.getBoundingClientRect();
    tooltip.style.left = (e.clientX - rect.left + 14) + "px";
    tooltip.style.top = (e.clientY - rect.top - 10) + "px";
  }).on("mouseleave", () => { tooltip.style.display = "none"; });

  // ‚îÄ‚îÄ Update positions helper ‚îÄ‚îÄ
  function updatePositions() {
    computePositions();
    ng.attr("transform", d => `translate(${d.x},${d.y})`)
      .select("circle").attr("opacity", d => 0.65 + 0.35 * ((d._z + 1) / 2));
    linkSel.attr("x1", d => d._src.x).attr("y1", d => d._src.y)
           .attr("x2", d => d._tgt.x).attr("y2", d => d._tgt.y);
  }

  // ‚îÄ‚îÄ Auto-rotation ‚îÄ‚îÄ
  let spinning = true;
  function spin() {
    if (!spinning) return;
    _angle += 0.003;
    updatePositions();
    requestAnimationFrame(spin);
  }

  // Start spinning when visible
  const observer = new IntersectionObserver(entries => {
    if (entries[0].isIntersecting) { spin(); observer.disconnect(); }
  }, { threshold: 0.2 });
  observer.observe(container);

  // ‚îÄ‚îÄ Drag to rotate ‚îÄ‚îÄ
  let dragStartX = null;
  const svgEl = svg.node();
  svgEl.addEventListener("mousedown", (e) => {
    if (e.target.closest(".mini-controls")) return;
    dragStartX = e.clientX;
    spinning = false;
  });
  window.addEventListener("mousemove", (e) => {
    if (dragStartX === null) return;
    const dx = e.clientX - dragStartX;
    _angle += dx * 0.005;
    dragStartX = e.clientX;
    updatePositions();
  });
  window.addEventListener("mouseup", () => {
    if (dragStartX !== null) {
      dragStartX = null;
      spinning = true;
      spin();
    }
  });

  // ‚îÄ‚îÄ Color mode buttons ‚îÄ‚îÄ
  document.querySelectorAll(".mini-btn[data-color]").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".mini-btn[data-color]").forEach(b => b.classList.remove("active"));
      btn.classList.add("active");
      colorMode = btn.dataset.color;
      ng.select("circle").transition().duration(400).attr("fill", d => getColor(d));
    });
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  QUIZ
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function renderQuiz() {
  const questions = [
    {
      q: "Which metric measures how often a person sits on the shortest path between two others in a network?",
      opts: ["PageRank", "Betweenness Centrality", "Degree Centrality", "Clustering Coefficient"],
      correct: 1,
      explain: "Betweenness Centrality counts the fraction of all shortest paths that pass through a given node. High betweenness = information bottleneck / broker."
    },
    {
      q: "Jeff Skilling (CEO) sent only 88 emails. Why does he still have the highest betweenness among named individuals?",
      opts: [
        "Because he received the most emails in the company",
        "Because he was the only path connecting many otherwise-separate groups",
        "Because he had the most direct reports",
        "Because he sent emails to the most unique recipients"
      ],
      correct: 1,
      explain: "Betweenness is about structural position, not volume. Skilling bridged multiple communities that had no other connection, making him the critical relay point even with minimal outbound email."
    },
    {
      q: "What does a high PageRank score indicate about a person in the network?",
      opts: [
        "They send the most emails",
        "They are connected to other highly-connected people",
        "They have the most direct reports",
        "They have been at the company the longest"
      ],
      correct: 1,
      explain: "PageRank is recursive: your importance depends on the importance of those connected to you. Being linked by other high-PageRank nodes boosts your score."
    },
    {
      q: "Jacqueline Coleman sent only 32 emails, yet had a betweenness of 0.062 ‚Äî higher than the CEO. What does this likely indicate?",
      opts: [
        "She was a senior executive who delegated email to an assistant",
        "She was an information gatekeeper bridging otherwise disconnected groups",
        "Her email account was shared by multiple people",
        "The data is likely erroneous for her account"
      ],
      correct: 1,
      explain: "This is the classic 'hidden broker' ‚Äî a person with low formal power but extreme structural influence. Removing her from the network would disconnect entire communities."
    },
    {
      q: "Why does the Enron SNA weight each email edge by 1/N (where N = number of recipients)?",
      opts: [
        "To penalize people who receive too many emails",
        "To normalize for broadcast emails that would otherwise dominate tie strength",
        "To account for the length of the email body",
        "To adjust for time zone differences between sender and recipients"
      ],
      correct: 1,
      explain: "A mass email to 100 people creates weak ties. A direct 1-to-1 email creates a strong tie. Dividing by N ensures the weight reflects actual relationship strength, not broadcast volume."
    }
  ];

  const wrap = document.getElementById("quiz-wrap");
  let answered = new Array(questions.length).fill(-1);

  questions.forEach((q, qi) => {
    const div = document.createElement("div");
    div.className = "quiz-q";
    div.id = `quiz-q-${qi}`;
    div.innerHTML = `
      <h4><span class="qnum">${qi+1}</span> ${q.q}</h4>
      <div class="quiz-options">
        ${q.opts.map((opt, oi) => `
          <div class="quiz-opt" data-q="${qi}" data-o="${oi}">
            <span class="radio"></span>
            <span>${opt}</span>
          </div>
        `).join("")}
      </div>
      <div class="quiz-feedback" id="quiz-fb-${qi}"></div>
    `;
    wrap.appendChild(div);
  });

  // Submit button
  const submitBtn = document.createElement("button");
  submitBtn.className = "quiz-submit";
  submitBtn.textContent = "Check Answers";
  wrap.appendChild(submitBtn);

  // Score display
  const scoreDiv = document.createElement("div");
  scoreDiv.className = "quiz-score";
  scoreDiv.id = "quiz-score";
  wrap.appendChild(scoreDiv);

  // Option selection
  document.querySelectorAll(".quiz-opt").forEach(opt => {
    opt.addEventListener("click", () => {
      const qi = +opt.dataset.q;
      const oi = +opt.dataset.o;
      answered[qi] = oi;
      document.querySelectorAll(`.quiz-opt[data-q="${qi}"]`).forEach(o => o.classList.remove("selected"));
      opt.classList.add("selected");
    });
  });

  // Submit
  submitBtn.addEventListener("click", () => {
    let score = 0;
    questions.forEach((q, qi) => {
      const fb = document.getElementById(`quiz-fb-${qi}`);
      document.querySelectorAll(`.quiz-opt[data-q="${qi}"]`).forEach(o => {
        o.classList.remove("selected");
        const oi = +o.dataset.o;
        if (oi === q.correct) o.classList.add("correct");
        else if (oi === answered[qi]) o.classList.add("wrong");
        o.style.pointerEvents = "none";
      });
      if (answered[qi] === q.correct) {
        score++;
        fb.className = "quiz-feedback show right";
        fb.textContent = "‚úì Correct! " + q.explain;
      } else {
        fb.className = "quiz-feedback show incorrect";
        fb.textContent = "‚úó Incorrect. " + q.explain;
      }
    });
    scoreDiv.style.display = "block";
    scoreDiv.innerHTML = `<div class="big">${score}/${questions.length}</div><p style="color:var(--muted);margin-top:8px;">${score === questions.length ? "Perfect score! You've mastered SNA fundamentals." : score >= 3 ? "Good understanding! Review the missed concepts above." : "Review the sections above and try to understand each explanation."}</p>`;
    submitBtn.style.display = "none";
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BOOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
loadData();
</script>
</body>
</html>
