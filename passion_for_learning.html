<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Passion for Learning ‚Äî AI Case Analysis Tools</title>
  <meta name="description" content="AI-powered tools for case study analysis: Partner AI Simulator and Pre-grader Template."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet"/>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    :root{--bg:#05070d;--bg2:#0b0f1a;--bg3:#111827;--bg4:#1a2332;--border:#1e2a3a;
      --accent:#00e5ff;--accent2:#ff4d6d;--accent3:#a855f7;--amber:#fbbf24;--green:#22c55e;
      --text:#e2e8f0;--muted:#64748b;--font-ui:"Syne",sans-serif;--font-mono:"Space Mono",monospace;}
    html{scroll-behavior:smooth;}
    body{background:var(--bg);color:var(--text);font-family:var(--font-ui);font-size:15px;line-height:1.7;
      overflow-x:hidden;min-height:100vh;}

    /* NAV */
    nav{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(5,7,13,0.92);
      backdrop-filter:blur(16px);border-bottom:1px solid var(--border);padding:0 32px;height:52px;
      display:flex;align-items:center;justify-content:space-between;}
    nav::after{content:"";position:absolute;bottom:0;left:0;right:0;height:1px;
      background:linear-gradient(90deg,transparent,var(--amber) 40%,var(--accent2) 60%,transparent);opacity:0.5;}
    .nav-logo{font-family:var(--font-mono);font-size:13px;color:var(--amber);letter-spacing:0.13em;text-transform:uppercase;}
    .nav-logo span{color:var(--accent2);}
    .nav-links{display:flex;gap:24px;}
    .nav-links a{font-size:12px;color:var(--muted);text-decoration:none;text-transform:uppercase;letter-spacing:0.1em;transition:color 0.2s;}
    .nav-links a:hover{color:var(--accent);}

    /* LAYOUT */
    .page-wrap{max-width:1300px;margin:0 auto;padding:80px 32px 48px;}

    /* HERO */
    .hero{text-align:center;padding:40px 0 60px;}
    .hero-badge{font-family:var(--font-mono);font-size:11px;color:var(--amber);text-transform:uppercase;
      letter-spacing:0.2em;margin-bottom:16px;border:1px solid rgba(251,191,36,0.3);padding:6px 18px;
      border-radius:20px;background:rgba(251,191,36,0.06);display:inline-block;}
    .hero h1{font-size:clamp(1.8rem,3.5vw,2.8rem);font-weight:800;line-height:1.2;margin-bottom:16px;}
    .hero h1 .glow{background:linear-gradient(135deg,var(--amber),var(--accent2));-webkit-background-clip:text;
      background-clip:text;-webkit-text-fill-color:transparent;}
    .hero-sub{font-size:15px;color:var(--muted);max-width:650px;margin:0 auto;line-height:1.6;}

    /* TABS */
    .tab-bar{display:flex;gap:4px;margin-bottom:24px;border-bottom:1px solid var(--border);padding-bottom:0;}
    .tab-btn{font-family:var(--font-mono);font-size:12px;text-transform:uppercase;letter-spacing:0.08em;
      padding:12px 24px;border:none;background:transparent;color:var(--muted);cursor:pointer;
      border-bottom:2px solid transparent;transition:all 0.2s;}
    .tab-btn:hover{color:var(--text);}
    .tab-btn.active{color:var(--accent);border-bottom-color:var(--accent);}
    .tab-panel{display:none;}
    .tab-panel.active{display:block;}

    /* PARTNER AI */
    .chat-container{display:flex;flex-direction:column;height:calc(100vh - 280px);min-height:500px;
      background:var(--bg2);border:1px solid var(--border);border-radius:14px;overflow:hidden;}
    .chat-header{padding:16px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:12px;}
    .chat-header .avatar{width:36px;height:36px;border-radius:50%;background:linear-gradient(135deg,var(--accent2),var(--accent3));
      display:flex;align-items:center;justify-content:center;font-size:18px;}
    .chat-header-info h3{font-size:14px;font-weight:700;}
    .chat-header-info p{font-size:11px;color:var(--muted);}
    .chat-messages{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:14px;}
    .chat-messages::-webkit-scrollbar{width:3px;}
    .chat-messages::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
    .msg{max-width:80%;padding:12px 16px;border-radius:12px;font-size:13px;line-height:1.6;animation:fadeIn 0.3s ease;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
    .msg.partner{background:var(--bg3);border:1px solid var(--border);border-radius:12px 12px 12px 2px;align-self:flex-start;}
    .msg.student{background:rgba(0,229,255,0.08);border:1px solid rgba(0,229,255,0.2);
      border-radius:12px 12px 2px 12px;align-self:flex-end;color:var(--text);}
    .msg .role{font-family:var(--font-mono);font-size:9px;text-transform:uppercase;letter-spacing:0.12em;
      margin-bottom:6px;display:block;}
    .msg.partner .role{color:var(--accent2);}
    .msg.student .role{color:var(--accent);}
    .chat-input-wrap{padding:16px 20px;border-top:1px solid var(--border);display:flex;gap:10px;}
    .chat-input{flex:1;background:var(--bg3);border:1px solid var(--border);border-radius:10px;
      padding:12px 16px;font-family:var(--font-ui);font-size:13px;color:var(--text);resize:none;
      outline:none;min-height:48px;max-height:120px;}
    .chat-input:focus{border-color:var(--accent);}
    .chat-input::placeholder{color:var(--muted);}
    .chat-send{background:linear-gradient(135deg,var(--accent),var(--accent3));border:none;border-radius:10px;
      padding:0 20px;font-family:var(--font-mono);font-size:12px;color:#000;font-weight:700;cursor:pointer;
      text-transform:uppercase;letter-spacing:0.08em;transition:transform 0.2s;}
    .chat-send:hover{transform:translateY(-1px);}

    /* API CONFIG */
    .api-config{margin-bottom:20px;background:var(--bg2);border:1px solid var(--border);border-radius:12px;padding:16px 20px;}
    .api-config summary{font-family:var(--font-mono);font-size:11px;color:var(--amber);text-transform:uppercase;
      letter-spacing:0.1em;cursor:pointer;}
    .api-config-inner{margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:10px;}
    .api-config label{font-size:11px;color:var(--muted);display:block;margin-bottom:3px;}
    .api-config input,.api-config select{width:100%;background:var(--bg3);border:1px solid var(--border);
      color:var(--text);padding:8px 12px;font-family:var(--font-mono);font-size:11px;border-radius:6px;outline:none;}
    .api-config input:focus{border-color:var(--accent);}

    /* PREGRADER */
    .pregrader-layout{display:grid;grid-template-columns:1fr 1fr;gap:20px;min-height:600px;}
    @media(max-width:900px){.pregrader-layout{grid-template-columns:1fr;}}
    .pregrader-panel{background:var(--bg2);border:1px solid var(--border);border-radius:14px;overflow:hidden;
      display:flex;flex-direction:column;}
    .pregrader-panel-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;
      align-items:center;gap:10px;}
    .pregrader-panel-header .dot{width:10px;height:10px;border-radius:50%;}
    .pregrader-panel-header h3{font-family:var(--font-mono);font-size:12px;text-transform:uppercase;letter-spacing:0.1em;}
    .pregrader-panel-body{flex:1;padding:16px 20px;overflow-y:auto;}

    .submission-area{width:100%;min-height:300px;background:var(--bg3);border:1px solid var(--border);
      border-radius:8px;padding:14px;font-family:var(--font-ui);font-size:13px;color:var(--text);
      resize:vertical;outline:none;line-height:1.6;}
    .submission-area:focus{border-color:var(--accent);}
    .submission-area::placeholder{color:var(--muted);}

    /* RUBRIC */
    .rubric-item{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:14px;
      margin-bottom:10px;display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;}
    .rubric-item input[type=text]{background:var(--bg);border:1px solid var(--border);color:var(--text);
      padding:6px 10px;font-size:12px;border-radius:6px;outline:none;width:100%;}
    .rubric-item input[type=number]{background:var(--bg);border:1px solid var(--border);color:var(--text);
      padding:6px 10px;font-size:12px;border-radius:6px;outline:none;width:60px;text-align:center;}
    .rubric-remove{background:none;border:1px solid var(--border);color:var(--accent2);border-radius:6px;
      padding:4px 10px;cursor:pointer;font-size:12px;transition:all 0.2s;}
    .rubric-remove:hover{border-color:var(--accent2);background:rgba(255,77,109,0.08);}

    .add-rubric-btn,.evaluate-btn,.export-btn{font-family:var(--font-mono);font-size:11px;text-transform:uppercase;
      letter-spacing:0.08em;padding:10px 20px;border-radius:8px;cursor:pointer;transition:all 0.2s;border:none;}
    .add-rubric-btn{background:var(--bg3);border:1px solid var(--border);color:var(--muted);margin-top:8px;}
    .add-rubric-btn:hover{border-color:var(--accent);color:var(--accent);}
    .evaluate-btn{background:linear-gradient(135deg,var(--accent),var(--accent3));color:#000;font-weight:700;margin-top:16px;}
    .evaluate-btn:hover{transform:translateY(-1px);box-shadow:0 4px 16px rgba(0,229,255,0.2);}
    .export-btn{background:var(--bg3);border:1px solid var(--border);color:var(--muted);margin-top:8px;}
    .export-btn:hover{border-color:var(--amber);color:var(--amber);}

    /* EVALUATION OUTPUT */
    .eval-output{margin-top:16px;}
    .eval-card{background:var(--bg3);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:10px;}
    .eval-card h4{font-size:13px;font-weight:700;margin-bottom:6px;display:flex;justify-content:space-between;}
    .eval-card .score{font-family:var(--font-mono);font-size:14px;font-weight:700;}
    .eval-bar{height:6px;background:var(--bg);border-radius:3px;overflow:hidden;margin-bottom:8px;}
    .eval-fill{height:100%;border-radius:3px;transition:width 0.6s ease;}
    .eval-card p{font-size:12px;color:var(--muted);line-height:1.5;}

    .eval-summary{background:var(--bg3);border:1px solid var(--accent);border-radius:12px;padding:20px;text-align:center;margin-top:16px;}
    .eval-summary .big{font-family:var(--font-mono);font-size:36px;font-weight:700;color:var(--accent);}
    .eval-summary p{font-size:12px;color:var(--muted);margin-top:4px;}

    footer{text-align:center;padding:48px 32px;border-top:1px solid var(--border);color:var(--muted);font-size:12px;}
    footer a{color:var(--accent);text-decoration:none;}
  </style>
</head>
<body>

<nav>
  <div class="nav-logo">Passion<span>::</span>Learning <span>// AI Tools</span></div>
  <div class="nav-links">
    <a href="#simulator">Simulator</a>
    <a href="#pregrader">Pre-grader</a>
    <a href="learning_module.html">Learning Module</a>
    <a href="od_syllabus.html">OD Syllabus</a>
    <a href="index.html">Dashboard ‚Üó</a>
  </div>
</nav>

<div class="page-wrap">
  <!-- HERO -->
  <div class="hero">
    <div class="hero-badge">Orientation Case ¬∑ AI-Assisted Analysis</div>
    <h1>The <span class="glow">"Passion for Learning"</span> Toolkit</h1>
    <p class="hero-sub">
      Two AI-powered tools to help students analyze the case study and help professors evaluate submissions.
      Designed as a plug-in template ‚Äî ready for when the case arrives.
    </p>
  </div>

  <!-- TABS -->
  <div class="tab-bar">
    <button class="tab-btn active" data-tab="simulator" id="simulator">üé≠ Partner AI Simulator</button>
    <button class="tab-btn" data-tab="pregrader" id="pregrader">üìã AI Pre-grader</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PARTNER AI SIMULATOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-panel active" id="panel-simulator">
    <details class="api-config">
      <summary>‚öô API Configuration</summary>
      <div class="api-config-inner">
        <div>
          <label>LLM Provider</label>
          <select id="api-provider">
            <option value="openai">OpenAI (GPT-4)</option>
            <option value="gemini">Google Gemini</option>
            <option value="anthropic">Anthropic Claude</option>
            <option value="local">Local / Ollama</option>
          </select>
        </div>
        <div>
          <label>API Key</label>
          <input type="password" id="api-key" placeholder="sk-..." />
        </div>
        <div>
          <label>Model</label>
          <input type="text" id="api-model" value="gpt-4o" placeholder="gpt-4o" />
        </div>
        <div>
          <label>API Endpoint (for local)</label>
          <input type="text" id="api-endpoint" value="https://api.openai.com/v1/chat/completions" />
        </div>
      </div>
    </details>

    <div class="chat-container">
      <div class="chat-header">
        <div class="avatar">üè¢</div>
        <div class="chat-header-info">
          <h3>Skeptical Consulting Partner</h3>
          <p>Senior Partner ¬∑ Strategy & Due Diligence ¬∑ Will grill you relentlessly</p>
        </div>
      </div>
      <div class="chat-messages" id="chat-messages">
        <div class="msg partner">
          <span class="role">Partner</span>
          I'm your senior consulting partner. You're presenting your analysis of the "Passion for Learning" case.
          I've been doing this for 20 years and I've seen hundreds of analyses ‚Äî most are superficial.
          <br><br>
          Go ahead. Walk me through your findings. I'll interrupt when something doesn't hold up.
          <br><br>
          <em style="color:var(--muted);">(Paste your case analysis below and I'll scrutinize it like a real partner would.)</em>
        </div>
      </div>
      <div class="chat-input-wrap">
        <textarea class="chat-input" id="chat-input" placeholder="Paste your case analysis or respond to the partner's challenge..." rows="2"></textarea>
        <button class="chat-send" id="chat-send">Send</button>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AI PRE-GRADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div class="tab-panel" id="panel-pregrader">
    <div class="pregrader-layout">
      <!-- Left: Submission -->
      <div class="pregrader-panel">
        <div class="pregrader-panel-header">
          <div class="dot" style="background:var(--accent);"></div>
          <h3 style="color:var(--accent);">Student Submission</h3>
        </div>
        <div class="pregrader-panel-body">
          <textarea class="submission-area" id="submission-text" placeholder="Paste the student's case analysis here..."></textarea>
        </div>
      </div>

      <!-- Right: Rubric + Evaluation -->
      <div class="pregrader-panel">
        <div class="pregrader-panel-header">
          <div class="dot" style="background:var(--accent3);"></div>
          <h3 style="color:var(--accent3);">Evaluation Rubric & Results</h3>
        </div>
        <div class="pregrader-panel-body">
          <div id="rubric-list">
            <div class="rubric-item">
              <input type="text" value="Data Accuracy & Quantitative Rigor" placeholder="Criterion name"/>
              <input type="number" value="25" min="0" max="100" title="Weight (%)"/>
              <button class="rubric-remove">‚úï</button>
            </div>
            <div class="rubric-item">
              <input type="text" value="Analytical Depth & Framework Application" placeholder="Criterion name"/>
              <input type="number" value="25" min="0" max="100" title="Weight (%)"/>
              <button class="rubric-remove">‚úï</button>
            </div>
            <div class="rubric-item">
              <input type="text" value="Alternative Perspectives Considered" placeholder="Criterion name"/>
              <input type="number" value="20" min="0" max="100" title="Weight (%)"/>
              <button class="rubric-remove">‚úï</button>
            </div>
            <div class="rubric-item">
              <input type="text" value="Clarity of Recommendations" placeholder="Criterion name"/>
              <input type="number" value="15" min="0" max="100" title="Weight (%)"/>
              <button class="rubric-remove">‚úï</button>
            </div>
            <div class="rubric-item">
              <input type="text" value="Presentation & Structure" placeholder="Criterion name"/>
              <input type="number" value="15" min="0" max="100" title="Weight (%)"/>
              <button class="rubric-remove">‚úï</button>
            </div>
          </div>
          <button class="add-rubric-btn" id="add-rubric">+ Add Criterion</button>
          <button class="evaluate-btn" id="evaluate-btn">‚ö° Evaluate Submission</button>

          <div class="eval-output" id="eval-output" style="display:none;">
            <div id="eval-cards"></div>
            <div class="eval-summary" id="eval-summary"></div>
            <button class="export-btn" id="export-btn">üì• Export Evaluation Summary</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<footer>
  <p>Passion for Learning ¬∑ AI Case Analysis Toolkit ¬∑ IIMB Orientation</p>
  <p style="margin-top:8px;">
    <a href="learning_module.html">‚Üê Learning Module</a> ¬∑
    <a href="od_syllabus.html">OD Syllabus</a> ¬∑
    <a href="index.html">Dashboard ‚Üó</a>
  </p>
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TABS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.querySelectorAll(".tab-btn").forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".tab-panel").forEach(p => p.classList.remove("active"));
    btn.classList.add("active");
    document.getElementById("panel-" + btn.dataset.tab).classList.add("active");
  });
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SYSTEM PROMPT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SYSTEM_PROMPT = `You are a senior consulting partner at a top-tier strategy firm (McKinsey/BCG/Bain caliber). You have 20 years of experience and have reviewed hundreds of case analyses.

Your role: GRILL the student on their analysis of the "Passion for Learning" case study. Be skeptical, demanding, and push them to think deeper.

Your evaluation criteria:
1. DATA ACCURACY: Are their numbers right? Do they cite specific figures from the case?
2. ANALYTICAL DEPTH: Do they go beyond surface-level analysis? Do they use frameworks properly?
3. ALTERNATIVE PERSPECTIVES: Did they consider counterarguments? Multiple scenarios?
4. QUANTITATIVE RIGOR: Did they build financial models? Sensitivity analysis? NPV/IRR?
5. ACTIONABLE RECOMMENDATIONS: Are their recommendations specific, measurable, and implementable?

Behavior rules:
- Start by listening to their analysis
- Ask incisive follow-up questions that expose weak assumptions
- Challenge vague statements ("What exactly do you mean by 'significant growth'?")
- Demand numbers ("Give me the specific figure from the case")
- Play devil's advocate ("What if the opposite were true?")
- Be blunt but professional ‚Äî this is training, not cruelty
- After 3-4 exchanges, give them a brief evaluation of their performance
- Use short, punchy sentences. Partners don't ramble.`;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHAT LOGIC ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const chatMessages = document.getElementById("chat-messages");
const chatInput = document.getElementById("chat-input");
const chatSendBtn = document.getElementById("chat-send");
let conversationHistory = [{ role: "system", content: SYSTEM_PROMPT }];

function addMessage(content, role) {
  const div = document.createElement("div");
  div.className = `msg ${role}`;
  const roleLabel = role === "partner" ? "Partner" : "You";
  div.innerHTML = `<span class="role">${roleLabel}</span>${content.replace(/\n/g, "<br>")}`;
  chatMessages.appendChild(div);
  chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function sendMessage() {
  const text = chatInput.value.trim();
  if (!text) return;

  addMessage(text, "student");
  chatInput.value = "";
  conversationHistory.push({ role: "user", content: text });

  const apiKey = document.getElementById("api-key").value;
  const model = document.getElementById("api-model").value;
  const endpoint = document.getElementById("api-endpoint").value;
  const provider = document.getElementById("api-provider").value;

  if (!apiKey) {
    // Simulate a response without API
    const simulated = simulatePartnerResponse(text);
    addMessage(simulated, "partner");
    conversationHistory.push({ role: "assistant", content: simulated });
    return;
  }

  // Show typing indicator
  const typing = document.createElement("div");
  typing.className = "msg partner";
  typing.innerHTML = '<span class="role">Partner</span><em style="color:var(--muted);">Thinking...</em>';
  chatMessages.appendChild(typing);
  chatMessages.scrollTop = chatMessages.scrollHeight;

  try {
    let response;
    if (provider === "openai" || provider === "local") {
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
        body: JSON.stringify({ model, messages: conversationHistory, temperature: 0.8, max_tokens: 800 })
      });
      response = await res.json();
      const reply = response.choices?.[0]?.message?.content || "Error: No response received.";
      chatMessages.removeChild(typing);
      addMessage(reply, "partner");
      conversationHistory.push({ role: "assistant", content: reply });
    } else {
      chatMessages.removeChild(typing);
      addMessage("This provider integration is coming soon. Please use OpenAI or set up a local endpoint for now.", "partner");
    }
  } catch (err) {
    chatMessages.removeChild(typing);
    addMessage(`API Error: ${err.message}. Try the simulated mode (leave API key empty).`, "partner");
  }
}

function simulatePartnerResponse(input) {
  const responses = [
    `Interesting. But let me push back on that. You said "${input.slice(0, 50)}..." ‚Äî what's the specific data point from the case that supports this? I need numbers, not narratives.`,
    `I've heard this kind of analysis before from first-year associates. It's surface-level. What happens if the key assumption is wrong? Walk me through the downside scenario.`,
    `Okay, that's a starting point. But you haven't addressed the financial implications. What's the NPV of the option you're recommending? Have you run a sensitivity analysis on the key variables?`,
    `You're making an assertion without evidence. In consulting, that's a yellow card. Go back to the case data ‚Äî what do the actual numbers tell you? Don't tell me what you *think*. Tell me what the *data* says.`,
    `Let me ask it differently: if you were the CEO and your career was on the line, would you bet on this recommendation? What's your confidence interval? What would need to be true for this to work?`,
    `Good point about the qualitative factors, but you're ignoring the quantitative dimension entirely. The case gives you three financial options with cash flows over 10 years. Have you compared them? Which one maximizes value?`,
    `I notice you haven't mentioned opportunity cost at all. Every choice you make means something you're NOT doing. What are you leaving on the table with this recommendation?`,
  ];
  return responses[Math.floor(Math.random() * responses.length)];
}

chatSendBtn.addEventListener("click", sendMessage);
chatInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter" && !e.shiftKey) { e.preventDefault(); sendMessage(); }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RUBRIC MANAGEMENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById("add-rubric").addEventListener("click", () => {
  const item = document.createElement("div");
  item.className = "rubric-item";
  item.innerHTML = `
    <input type="text" value="" placeholder="New criterion name"/>
    <input type="number" value="10" min="0" max="100" title="Weight (%)"/>
    <button class="rubric-remove">‚úï</button>
  `;
  document.getElementById("rubric-list").appendChild(item);
  item.querySelector(".rubric-remove").addEventListener("click", () => item.remove());
});

document.querySelectorAll(".rubric-remove").forEach(btn => {
  btn.addEventListener("click", () => btn.closest(".rubric-item").remove());
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EVALUATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById("evaluate-btn").addEventListener("click", async () => {
  const submission = document.getElementById("submission-text").value.trim();
  if (!submission) { alert("Please paste a student submission first."); return; }

  const rubricItems = [];
  document.querySelectorAll("#rubric-list .rubric-item").forEach(item => {
    const name = item.querySelector("input[type=text]").value;
    const weight = parseInt(item.querySelector("input[type=number]").value) || 0;
    if (name) rubricItems.push({ name, weight });
  });

  const apiKey = document.getElementById("api-key").value;

  if (apiKey) {
    await evaluateWithAPI(submission, rubricItems);
  } else {
    evaluateSimulated(submission, rubricItems);
  }
});

function evaluateSimulated(submission, rubricItems) {
  const wordCount = submission.split(/\s+/).length;
  const hasNumbers = /\d+/.test(submission);
  const hasFramework = /framework|analysis|strategy|model|npv|irr|roi/i.test(submission);

  const results = rubricItems.map(item => {
    let score;
    if (item.name.toLowerCase().includes("data") || item.name.toLowerCase().includes("quant"))
      score = hasNumbers ? 60 + Math.random()*25 : 20 + Math.random()*20;
    else if (item.name.toLowerCase().includes("depth") || item.name.toLowerCase().includes("framework"))
      score = hasFramework ? 55 + Math.random()*30 : 25 + Math.random()*25;
    else
      score = 35 + Math.random()*40 + (wordCount > 200 ? 10 : 0);

    score = Math.min(100, Math.round(score));
    return { ...item, score, feedback: generateFeedback(item.name, score) };
  });

  displayEvaluation(results);
}

function generateFeedback(criterion, score) {
  if (score >= 75) return `Strong performance on ${criterion.toLowerCase()}. The analysis shows clear evidence of rigorous thinking. Consider adding more quantitative backing to elevate further.`;
  if (score >= 50) return `Adequate on ${criterion.toLowerCase()}, but room for improvement. The analysis touches on key points but lacks depth in some areas. More specific data references would strengthen the argument.`;
  return `Significant gaps in ${criterion.toLowerCase()}. The submission needs substantially more work here ‚Äî lacks specificity, quantitative rigor, or evidence from the case data. Review the case financials carefully.`;
}

async function evaluateWithAPI(submission, rubricItems) {
  const apiKey = document.getElementById("api-key").value;
  const model = document.getElementById("api-model").value;
  const endpoint = document.getElementById("api-endpoint").value;

  const rubricStr = rubricItems.map((r,i)=>`${i+1}. ${r.name} (Weight: ${r.weight}%)`).join("\n");

  const prompt = `Evaluate this student case study submission against the rubric below. For each criterion, provide:
- A score from 0-100
- A 1-2 sentence feedback

Rubric:
${rubricStr}

Student Submission:
${submission}

Respond in JSON format:
{"evaluations": [{"criterion": "...", "score": N, "feedback": "..."}]}`;

  try {
    const res = await fetch(endpoint, {
      method: "POST",
      headers: { "Content-Type": "application/json", "Authorization": `Bearer ${apiKey}` },
      body: JSON.stringify({ model, messages: [
        { role: "system", content: "You are an expert academic evaluator. Return ONLY valid JSON." },
        { role: "user", content: prompt }
      ], temperature: 0.3, max_tokens: 1000 })
    });
    const data = await res.json();
    const content = data.choices?.[0]?.message?.content || "";
    const parsed = JSON.parse(content.replace(/```json\n?|```/g, ""));
    const results = parsed.evaluations.map((e,i) => ({
      name: e.criterion, weight: rubricItems[i]?.weight || 0,
      score: e.score, feedback: e.feedback
    }));
    displayEvaluation(results);
  } catch (err) {
    alert("API evaluation failed: " + err.message + ". Using simulated evaluation.");
    evaluateSimulated(submission, rubricItems);
  }
}

function displayEvaluation(results) {
  const output = document.getElementById("eval-output");
  const cards = document.getElementById("eval-cards");
  const summary = document.getElementById("eval-summary");
  output.style.display = "block";
  cards.innerHTML = "";

  let totalWeighted = 0, totalWeight = 0;
  results.forEach(r => {
    totalWeighted += r.score * r.weight;
    totalWeight += r.weight;

    const color = r.score >= 75 ? "var(--green)" : r.score >= 50 ? "var(--amber)" : "var(--accent2)";
    const card = document.createElement("div");
    card.className = "eval-card";
    card.innerHTML = `
      <h4>${r.name} <span class="score" style="color:${color};">${r.score}/100</span></h4>
      <div class="eval-bar"><div class="eval-fill" style="width:${r.score}%;background:${color};"></div></div>
      <p>${r.feedback}</p>
    `;
    cards.appendChild(card);
  });

  const overall = totalWeight > 0 ? Math.round(totalWeighted / totalWeight) : 0;
  const grade = overall >= 85 ? "A" : overall >= 75 ? "B+" : overall >= 65 ? "B" : overall >= 55 ? "C+" : overall >= 45 ? "C" : "Needs Work";
  summary.innerHTML = `<div class="big">${overall}/100</div><p>Overall Weighted Score ¬∑ Grade: <strong>${grade}</strong></p>`;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê EXPORT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.getElementById("export-btn").addEventListener("click", () => {
  const cards = document.querySelectorAll(".eval-card");
  let text = "=== AI PRE-GRADER EVALUATION ===\n\n";
  cards.forEach(card => {
    const h4 = card.querySelector("h4");
    const p = card.querySelector("p");
    text += h4.textContent + "\n" + p.textContent + "\n\n";
  });
  const summary = document.getElementById("eval-summary");
  text += "OVERALL: " + summary.textContent + "\n";

  const blob = new Blob([text], {type:"text/plain"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "evaluation-summary.txt";
  a.click();
});
</script>
</body>
</html>
